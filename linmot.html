<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Linmot Driver
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="BRML Instrument Drivers"/>
    <meta name="author" content="Technical University Munich"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="https://brml.github.io/BRMLDrivers/content/style.css" />
    <script type="text/javascript" src="https://brml.github.io/BRMLDrivers/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->

    <script type="text/javascript" async
              src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="https://github.com/BRML/BRMLDrivers/tree/0.2">github page</a></li>
        </ul>
        <h3 class="muted"><a href="https://brml.github.io/BRMLDrivers/index.html">BRML Drivers</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Linmot-Driver" class="anchor" href="#Linmot-Driver">Linmot Driver</a></h1>
<p>This driver support controlling a <a href="http://www.linmot.com/products/linear-motors/">Linmot</a> using the <a href="http://www.linmot.com/fileadmin/user_upload/Downloads/software-firmware/servo-drives/linmot-talk-6/Usermanual_LinRS_e_recent.pdf">LinRS serial protocol</a>.
It has been tested using a <a href="http://shop.linmot.com/D/ag7000.e12/drives-f%C3%BCr-motoren-p01-&amp;-pr01/serie-e1200/e1250-ec-uc.htm">Linmot E1250-EC-UC drive</a>, but should be compatible with more drives that support the LinRS protocol.
In our setup a standard RS232-to-USB adapter is used to connect the serial port of the drive to a PC.</p>
<p>The driver is provided by the <code>BRML.Drivers.LinmotT</code> type.
An instance of this type is fully thread-safe.
Movement requests will be queued and executed in arrival order.</p>
<h2><a name="Drive-parameter-configuration" class="anchor" href="#Drive-parameter-configuration">Drive parameter configuration</a></h2>
<p>Using the LinMot-Talk software the LinRS drive parameters must be configured as follows:</p>
<ul>
<li>LinRS -&gt; Dis-/Enable: Enable</li>
<li>LinRS -&gt; RS Config -&gt; Stop Bit: 1</li>
<li>LinRS -&gt; RS Config -&gt; Parity: None</li>
<li>LinRS -&gt; Protocol Config -&gt; MACID: as desired</li>
<li>LinRS -&gt; Protocol Config -&gt; Checksum: None</li>
<li>LinRS -&gt; Protocol Config -&gt; MC Response Configuration: Enable the following: Communication State, Status Word, State Var, Monitoring Channel 1. Disable all others.</li>
<li>LinRS -&gt; Protocol Config -&gt; MC Response Configuration -&gt; Channel 1 UPID: 1B8Dh (Actual Position)</li>
</ul>
<p>Note the value of the variable LinRS -&gt; MACID as you will need to specify it in the driver configuration.</p>
<h2><a name="Driver-configuration" class="anchor" href="#Driver-configuration">Driver configuration</a></h2>
<p>Instantiating the driver requires providing a configuration record of type <code>BRML.Drivers.LinmotCfgT</code>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span class="i">BRML</span><span class="o">.</span><span class="i">Drivers</span>

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">cfg</span> <span class="o">=</span> {
    <span class="i">PortName</span>       <span class="o">=</span> <span class="s">&quot;COM6&quot;</span>    <span class="c">// adjust</span>
    <span class="i">PortBaud</span>       <span class="o">=</span> <span class="n">57600</span>     <span class="c">// adjust</span>
    <span class="i">Id</span>             <span class="o">=</span> <span class="n">0x11</span>      <span class="c">// adjust</span>
    <span class="i">DefaultVel</span>     <span class="o">=</span> <span class="n">50.0</span>
    <span class="i">DefaultAccel</span>   <span class="o">=</span> <span class="n">200.0</span>    
}
</code></pre></td>
</tr>
</table>
<p><code>PortName</code> is the serial port name.
<code>PortBaud</code> must match the baud rate configured in the drive, using the LinRS -&gt; RS Config -&gt; Baud Rate parameters.
<code>Id</code> must match the drive variable LinRS -&gt; MACID.
<code>DefaultVel</code> specifies the default movement velocity in <span class="math">\(\mathrm{mm}/\mathrm{s}\)</span>.
<code>DefaultAccel</code> specifies the default acceleration and deceleration in <span class="math">\(\mathrm{mm}/\mathrm{s^2}\)</span>.</p>
<h2><a name="Driver-instance" class="anchor" href="#Driver-instance">Driver instance</a></h2>
<p>We can now instantiate the driver.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">linmot</span> <span class="o">=</span> <span class="k">new</span> <span class="i">LinmotT</span> (<span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="i">cfg</span>)
</code></pre></td>
</tr>
</table>
<p>Initialization and checking of communication is performed automatically.</p>
<p>All driver instance methods return an <code>Async&lt;_&gt;</code> instance.
You can perform <a href="https://fsharpforfunandprofit.com/posts/concurrency-async-and-parallel/">asynchronous control</a> or pipe all results into the <code>Async.RunSynchronously</code> to perform immediate command execution and wait for the operation to finish before your program continues.</p>
<h2><a name="Homing" class="anchor" href="#Homing">Homing</a></h2>
<p>The drive must be homed (finding the zero reference position) before movement commands can be send.
Use the <code>linmot.Home</code> method for that.
By default, homing is only performed if the drive is currently not homed.
You can override this behavior and force homing, by specifying an additional parameter with the value true.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="i">linmot</span><span class="o">.</span><span class="i">Home</span> () <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 5)" onmouseover="showTip(event, 'fs3', 5)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Getting-the-current-position" class="anchor" href="#Getting-the-current-position">Getting the current position</a></h2>
<p>The current position in <span class="math">\(\mathrm{mm}\)</span> is available in the <code>linmot.Pos</code> property.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="f">printfn</span> <span class="s">&quot;The Linmot is currently at </span><span class="pf">%.3f</span><span class="s"> mm.&quot;</span> <span onmouseout="hideTip(event, 'fs2', 8)" onmouseover="showTip(event, 'fs2', 8)" class="i">linmot</span><span class="o">.</span><span class="i">Pos</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Moving" class="anchor" href="#Moving">Moving</a></h2>
<p>Use the <code>linmot.DriveTo</code> method to move the Linmot to the specified position in <span class="math">\(\mathrm{mm}\)</span>.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 9)" onmouseover="showTip(event, 'fs2', 9)" class="i">linmot</span><span class="o">.</span><span class="i">DriveTo</span> <span class="o">-</span><span class="n">10.</span> <span class="c">(* mm *)</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 10)" onmouseover="showTip(event, 'fs3', 10)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 11)" onmouseover="showTip(event, 'fs4', 11)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<p>You can specify additional parameters corresponding to the velocity and acceleration.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 12)" onmouseover="showTip(event, 'fs2', 12)" class="i">linmot</span><span class="o">.</span><span class="i">DriveTo</span> (<span class="o">-</span><span class="n">20.</span> <span class="c">(* mm *)</span>, <span class="n">10.</span> <span class="c">(* mm/s *)</span>, <span class="n">100.</span> <span class="c">(* mm/s^2 *)</span>) <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 13)" onmouseover="showTip(event, 'fs3', 13)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 14)" onmouseover="showTip(event, 'fs4', 14)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<h2><a name="Power" class="anchor" href="#Power">Power</a></h2>
<p>You can turn motor power off, by calling the <code>linmot.Power</code> method with a <code>false</code> argument.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 15)" onmouseover="showTip(event, 'fs2', 15)" class="i">linmot</span><span class="o">.</span><span class="i">Power</span> <span class="k">false</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 16)" onmouseover="showTip(event, 'fs3', 16)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<p>The slider can now move freely.
You can still use the <code>linmot.Pos</code> property to obtain the actual position.</p>
<p>Specify a <code>true</code> argument to <code>linmot.Power</code> to re-enable the motor.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 18)" onmouseover="showTip(event, 'fs2', 18)" class="i">linmot</span><span class="o">.</span><span class="i">Power</span> <span class="k">true</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs3', 19)" onmouseover="showTip(event, 'fs3', 19)" class="t">Async</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs4', 20)" onmouseover="showTip(event, 'fs4', 20)" class="f">RunSynchronously</span>
</code></pre></td>
</tr>
</table>
<p>It is <em>not</em> necessary to home the motor again after toggling power off and then on.</p>
<h2><a name="Close-the-driver" class="anchor" href="#Close-the-driver">Close the driver</a></h2>
<p>You should dispose the driver instance when not using it anymore.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span onmouseout="hideTip(event, 'fs2', 21)" onmouseover="showTip(event, 'fs2', 21)" class="i">linmot</span><span class="o">.</span><span class="i">Dispose</span>()
</code></pre></td>
</tr>
</table>
<p>This will close the serial port.</p>

<div class="tip" id="fs1">val cfg : obj<br /><br />Full name: Linmot.cfg</div>
<div class="tip" id="fs2">val linmot : obj<br /><br />Full name: Linmot.linmot</div>
<div class="tip" id="fs3">Multiple items<br />type Async<br />static member AsBeginEnd : computation:(&#39;Arg -&gt; Async&lt;&#39;T&gt;) -&gt; (&#39;Arg * AsyncCallback * obj -&gt; IAsyncResult) * (IAsyncResult -&gt; &#39;T) * (IAsyncResult -&gt; unit)<br />static member AwaitEvent : event:IEvent&lt;&#39;Del,&#39;T&gt; * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt; (requires delegate and &#39;Del :&gt; Delegate)<br />static member AwaitIAsyncResult : iar:IAsyncResult * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member AwaitTask : task:Task -&gt; Async&lt;unit&gt;<br />static member AwaitTask : task:Task&lt;&#39;T&gt; -&gt; Async&lt;&#39;T&gt;<br />static member AwaitWaitHandle : waitHandle:WaitHandle * ?millisecondsTimeout:int -&gt; Async&lt;bool&gt;<br />static member CancelDefaultToken : unit -&gt; unit<br />static member Catch : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;Choice&lt;&#39;T,exn&gt;&gt;<br />static member FromBeginEnd : beginAction:(AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg:&#39;Arg1 * beginAction:(&#39;Arg1 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * beginAction:(&#39;Arg1 * &#39;Arg2 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromBeginEnd : arg1:&#39;Arg1 * arg2:&#39;Arg2 * arg3:&#39;Arg3 * beginAction:(&#39;Arg1 * &#39;Arg2 * &#39;Arg3 * AsyncCallback * obj -&gt; IAsyncResult) * endAction:(IAsyncResult -&gt; &#39;T) * ?cancelAction:(unit -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member FromContinuations : callback:((&#39;T -&gt; unit) * (exn -&gt; unit) * (OperationCanceledException -&gt; unit) -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member Ignore : computation:Async&lt;&#39;T&gt; -&gt; Async&lt;unit&gt;<br />static member OnCancel : interruption:(unit -&gt; unit) -&gt; Async&lt;IDisposable&gt;<br />static member Parallel : computations:seq&lt;Async&lt;&#39;T&gt;&gt; -&gt; Async&lt;&#39;T []&gt;<br />static member RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:CancellationToken -&gt; &#39;T<br />static member Sleep : millisecondsDueTime:int -&gt; Async&lt;unit&gt;<br />static member Start : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions * ?cancellationToken:CancellationToken -&gt; Task&lt;&#39;T&gt;<br />static member StartChild : computation:Async&lt;&#39;T&gt; * ?millisecondsTimeout:int -&gt; Async&lt;Async&lt;&#39;T&gt;&gt;<br />static member StartChildAsTask : computation:Async&lt;&#39;T&gt; * ?taskCreationOptions:TaskCreationOptions -&gt; Async&lt;Task&lt;&#39;T&gt;&gt;<br />static member StartImmediate : computation:Async&lt;unit&gt; * ?cancellationToken:CancellationToken -&gt; unit<br />static member StartWithContinuations : computation:Async&lt;&#39;T&gt; * continuation:(&#39;T -&gt; unit) * exceptionContinuation:(exn -&gt; unit) * cancellationContinuation:(OperationCanceledException -&gt; unit) * ?cancellationToken:CancellationToken -&gt; unit<br />static member SwitchToContext : syncContext:SynchronizationContext -&gt; Async&lt;unit&gt;<br />static member SwitchToNewThread : unit -&gt; Async&lt;unit&gt;<br />static member SwitchToThreadPool : unit -&gt; Async&lt;unit&gt;<br />static member TryCancelled : computation:Async&lt;&#39;T&gt; * compensation:(OperationCanceledException -&gt; unit) -&gt; Async&lt;&#39;T&gt;<br />static member CancellationToken : Async&lt;CancellationToken&gt;<br />static member DefaultCancellationToken : CancellationToken<br /><br />Full name: Microsoft.FSharp.Control.Async<br /><br />--------------------<br />type Async&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Control.Async&lt;_&gt;</div>
<div class="tip" id="fs4">static member Async.RunSynchronously : computation:Async&lt;&#39;T&gt; * ?timeout:int * ?cancellationToken:System.Threading.CancellationToken -&gt; &#39;T</div>
<div class="tip" id="fs5">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>

        </div>
        <div class="span3">
          <!-- <img src="https://brml.github.io/BRMLDrivers/img/logo.png" alt="BRML Drivers logo" style="width:150px;margin:10px" /> -->  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">BRML Drivers</li>
            <li><a href="https://brml.github.io/BRMLDrivers/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/BRMLDrivers">Get Library via NuGet</a></li>
            <li><a href="https://github.com/BRML/BRMLDrivers/tree/0.2">Source Code on GitHub</a></li>
            <li><a href="https://brml.github.io/BRMLDrivers/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Data Recorder</li>
            <li><a href="https://brml.github.io/BRMLDrivers/recorder-usage.html">Usage</a></li>

            <li class="nav-header">Instrument Drivers</li>
            <li><a href="https://brml.github.io/BRMLDrivers/linmot.html">Linmot</a></li>
            <li><a href="https://brml.github.io/BRMLDrivers/xytable.html">XY table</a></li>
            <li><a href="https://brml.github.io/BRMLDrivers/biotac.html">BioTac SP</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="https://brml.github.io/BRMLDrivers/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/BRML/BRMLDrivers/tree/0.2"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
